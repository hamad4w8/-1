<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„Ø¹Ø¨Ø© Ø§Ù„Ù…Ø§ÙÙŠØ§</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>
    
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #000;
            color: #fff;
            min-height: 100vh;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(100, 0, 0, 0.2) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(100, 0, 0, 0.2) 0%, transparent 20%);
            position: relative;
            overflow-x: hidden;
        }
        
        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%23ff0000' fill-opacity='0.07' fill-rule='evenodd'/%3E%3C/svg%3E");
            opacity: 0.4;
            z-index: -1;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        .page {
            display: none;
            width: 100%;
            text-align: center;
            animation: fadeIn 0.5s ease-in-out;
        }
        
        .active {
            display: block;
        }
        
        .logo {
            font-size: 3.5rem;
            color: #ff0000;
            margin-bottom: 20px;
            text-shadow: 0 0 10px rgba(255, 0, 0, 0.7), 0 0 20px rgba(255, 0, 0, 0.5);
            font-weight: bold;
            letter-spacing: 2px;
            position: relative;
        }
        
        .logo::after {
            content: 'MAFIA';
            position: absolute;
            top: 2px;
            left: 2px;
            color: rgba(255, 255, 255, 0.3);
            z-index: -1;
        }
        
        .subtitle {
            color: #aaa;
            margin-bottom: 40px;
            font-size: 1.2rem;
        }
        
        .blood-effect {
            position: relative;
        }
        
        .blood-effect::before {
            content: '';
            position: absolute;
            top: -10px;
            right: -10px;
            width: 30px;
            height: 30px;
            background-color: #8b0000;
            border-radius: 50%;
            opacity: 0.7;
            filter: blur(2px);
        }
        
        h1 {
            color: #ff0000;
            margin-bottom: 30px;
            font-size: 2.5rem;
            text-shadow: 0 0 5px rgba(255, 0, 0, 0.5);
        }
        
        h2 {
            color: #ff3333;
            margin-bottom: 20px;
            font-size: 2rem;
        }
        
        .input-container {
            margin: 30px 0;
        }
        
        input {
            width: 300px;
            padding: 15px;
            background-color: #222;
            border: 2px solid #ff0000;
            border-radius: 5px;
            color: white;
            font-size: 1.2rem;
            text-align: center;
            margin-bottom: 20px;
        }
        
        input:focus {
            outline: none;
            box-shadow: 0 0 10px rgba(255, 0, 0, 0.5);
        }
        
        .buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 30px;
        }
        
        .btn {
            padding: 15px 30px;
            background-color: #000;
            color: #ff0000;
            border: 2px solid #ff0000;
            border-radius: 5px;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 200px;
            font-weight: bold;
            position: relative;
            overflow: hidden;
        }
        
        .btn:hover {
            background-color: #ff0000;
            color: #000;
            box-shadow: 0 0 15px rgba(255, 0, 0, 0.7);
            transform: translateY(-3px);
        }
        
        .btn:active {
            transform: translateY(1px);
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: 0.5s;
        }
        
        .btn:hover::before {
            left: 100%;
        }
        
        .room-code {
            font-size: 3rem;
            color: #ff0000;
            margin: 30px 0;
            letter-spacing: 10px;
            background-color: #111;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #ff0000;
            text-shadow: 0 0 10px rgba(255, 0, 0, 0.7);
        }
        
        .player-list {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            margin: 30px 0;
        }
        
        .player {
            background-color: #222;
            padding: 10px 20px;
            border-radius: 5px;
            border: 1px solid #444;
            min-width: 150px;
        }
        
        .player.mafia {
            border-color: #ff0000;
            background-color: rgba(255, 0, 0, 0.1);
            color: #ff6666;
        }

        .player.doctor {
            border-color: #00ff00;
            background-color: rgba(0, 255, 0, 0.1);
            color: #66ff66;
        }

        .player.sheriff {
            border-color: #0000ff;
            background-color: rgba(0, 0, 255, 0.1);
            color: #6666ff;
        }

        .player.citizen {
            border-color: #aaaaaa;
            background-color: rgba(170, 170, 170, 0.1);
            color: #cccccc;
        }
        
        .role-reveal {
            font-size: 2rem;
            margin: 40px 0;
            padding: 30px;
            border-radius: 10px;
            background-color: rgba(255, 0, 0, 0.1);
            border: 2px solid #ff0000;
        }

        .role-reveal.mafia {
            border-color: #ff0000;
            background-color: rgba(255, 0, 0, 0.2);
            box-shadow: 0 0 20px rgba(255, 0, 0, 0.5);
        }

        .role-reveal.doctor {
            border-color: #00ff00;
            background-color: rgba(0, 255, 0, 0.2);
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.5);
        }

        .role-reveal.sheriff {
            border-color: #0000ff;
            background-color: rgba(0, 0, 255, 0.2);
            box-shadow: 0 0 20px rgba(0, 0, 255, 0.5);
        }

        .role-reveal.citizen {
            border-color: #aaaaaa;
            background-color: rgba(170, 170, 170, 0.2);
            box-shadow: 0 0 20px rgba(170, 170, 170, 0.5);
        }
        
        .role-name {
            color: #ff3333;
            font-weight: bold;
            text-shadow: 0 0 5px rgba(255, 0, 0, 0.5);
        }
        
        .selection-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin: 30px 0;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .selection-btn {
            padding: 15px;
            background-color: #222;
            border: 1px solid #444;
            border-radius: 5px;
            color: white;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .selection-btn:hover {
            background-color: #333;
            border-color: #ff0000;
        }
        
        .game-status {
            color: #ff6666;
            margin: 20px 0;
            font-size: 1.2rem;
        }
        
        .blood-drip {
            position: absolute;
            width: 3px;
            height: 50px;
            background-color: #8b0000;
            border-radius: 0 0 5px 5px;
            opacity: 0.7;
        }
        
        .blood-drip-1 {
            top: 10%;
            left: 10%;
        }
        
        .blood-drip-2 {
            top: 20%;
            right: 15%;
        }
        
        .blood-drip-3 {
            bottom: 30%;
            left: 20%;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .logo {
                font-size: 2.5rem;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .btn {
                width: 100%;
                max-width: 300px;
            }
            
            input {
                width: 100%;
                max-width: 300px;
            }
            
            .room-code {
                font-size: 2rem;
                letter-spacing: 5px;
            }
        }
    </style>
</head>
<body>
    <!-- ØªØ£Ø«ÙŠØ±Ø§Øª Ø¯Ù… -->
    <div class="blood-drip blood-drip-1"></div>
    <div class="blood-drip blood-drip-2"></div>
    <div class="blood-drip blood-drip-3"></div>
    
    <div class="container">
        <!-- Ø§Ù„ØµÙØ­Ø© 1: Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… -->
        <div id="page1" class="page active">
            <div class="logo blood-effect">Ù…Ø§ÙÙŠØ§</div>
            <p class="subtitle">Ù„Ø¹Ø¨Ø© Ø§Ù„Ø®ÙŠØ§Ù†Ø© ÙˆØ§Ù„Ø¯Ù‡Ø§Ø¡</p>
            <h1>Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ</h1>
            <div class="input-container">
                <input type="text" id="playerName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ù‡Ù†Ø§">
            </div>
            <button id="saveName" class="btn">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨Ø©</button>
        </div>
        
        <!-- Ø§Ù„ØµÙØ­Ø© 2: Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
        <div id="page2" class="page">
            <h1>Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù„Ø¹Ø¨Ø© Ø§Ù„Ù…Ø§ÙÙŠØ§</h1>
            <div class="buttons">
                <button id="joinRoom" class="btn">Ø§Ù†Ø¶Ù… Ù„ØºØ±ÙØ©</button>
                <button id="createRoom" class="btn">Ø£Ù†Ø´Ø¦ ØºØ±ÙØ©</button>
            </div>
        </div>
        
        <!-- Ø§Ù„ØµÙØ­Ø© 3: Ø¥Ù†Ø´Ø§Ø¡ ØºØ±ÙØ© -->
        <div id="page3" class="page">
            <h1>ØºØ±ÙØªÙƒ Ø§Ù„Ø¬Ø§Ù‡Ø²Ø©</h1>
            <p class="subtitle">Ø´Ø§Ø±Ùƒ Ø±Ù…Ø² Ø§Ù„ØºØ±ÙØ© Ù…Ø¹ Ø£ØµØ¯Ù‚Ø§Ø¦Ùƒ</p>
            <div class="room-code" id="roomCode">12345</div>
            <p class="game-status" id="gameStatus">ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†...</p>
            <div class="player-list" id="hostPlayerList">
                <!-- Ø§Ù„Ù„Ø§Ø¹Ø¨ÙˆÙ† Ø³ÙŠØ¶Ø§ÙÙˆÙ† Ù‡Ù†Ø§ -->
            </div>
            <button id="startGame" class="btn">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨Ø©</button>
        </div>
        
        <!-- Ø§Ù„ØµÙØ­Ø© 4: Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„ØºØ±ÙØ© -->
        <div id="page4" class="page">
            <h1>Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ø¥Ù„Ù‰ ØºØ±ÙØ©</h1>
            <div class="input-container">
                <input type="text" id="roomCodeInput" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù…Ø² Ø§Ù„ØºØ±ÙØ©">
            </div>
            <button id="connectToRoom" class="btn">Ø§Ù†Ø¶Ù…</button>
        </div>
        
        <!-- Ø§Ù„ØµÙØ­Ø© 5: Ø¯ÙˆØ±Ùƒ Ù„ØªØ±Ù‰ Ø´Ø®ØµÙŠØªÙƒ -->
        <div id="page5" class="page">
            <h1>Ø¯ÙˆØ±Ùƒ ÙŠØ§ <span id="playerNameDisplay"></span> Ù„ØªØ±Ù‰ Ø´Ø®ØµÙŠØªÙƒ</h1>
            <button id="nextToRole" class="btn">Ø§Ù„ØªØ§Ù„ÙŠ</button>
        </div>
        
        <!-- Ø§Ù„ØµÙØ­Ø© 6: ÙƒØ´Ù Ø§Ù„Ø´Ø®ØµÙŠØ© -->
        <div id="page6" class="page">
            <h1>ÙŠØ§ <span id="playerNameDisplay2"></span>ØŒ Ø£Ù†Øª:</h1>
            <div class="role-reveal" id="roleReveal">
                <span id="playerRole" class="role-name">Ø§Ù„Ù…ÙˆØ§Ø·Ù†</span>
            </div>
            <button id="nextToNight" class="btn">Ø§Ù„ØªØ§Ù„ÙŠ</button>
        </div>
        
        <!-- Ø§Ù„ØµÙØ­Ø© 7: Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø´Ø®ØµÙŠØ§Øª -->
        <div id="page7" class="page">
            <h1>Ù„Ù‚Ø¯ Ø§Ù†ØªÙ‡Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø´Ø®ØµÙŠØ§Øª</h1>
            <p class="subtitle">Ø§Ù„Ø¬Ù…ÙŠØ¹ ÙŠØ¹Ø±Ù Ø´Ø®ØµÙŠØªÙ‡ Ø§Ù„Ø¢Ù†</p>
            <button id="startNight" class="btn">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù†ÙˆÙ…</button>
        </div>
        
        <!-- Ø§Ù„ØµÙØ­Ø© 8: Ù„ÙŠÙ„Ø© Ø§Ù„Ù…Ø§ÙÙŠØ§ -->
        <div id="page8" class="page">
            <h1>Ø§Ù„Ù…Ø§ÙÙŠØ§: Ù…Ù† ØªØ±ÙŠØ¯ Ø£Ù† ØªØ°Ø¨Ø­ØŸ</h1>
            <div class="selection-list" id="mafiaSelection">
                <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ù„Ù„Ø§Ø®ØªÙŠØ§Ø± -->
            </div>
        </div>
        
        <!-- Ø§Ù„ØµÙØ­Ø© 9: Ø¯ÙˆØ± Ø§Ù„Ø¯ÙƒØªÙˆØ± -->
        <div id="page9" class="page">
            <h1>Ø£Ø¹Ø· Ø§Ù„Ø¬ÙˆØ§Ù„ Ù„Ù„Ø¯ÙƒØªÙˆØ±</h1>
            <button id="nextToDoctor" class="btn">Ø§Ù„ØªØ§Ù„ÙŠ</button>
        </div>
        
        <!-- Ø§Ù„ØµÙØ­Ø© 10: Ø¯ÙˆØ± Ø§Ù„Ø¯ÙƒØªÙˆØ± -->
        <div id="page10" class="page">
            <h1>Ø§Ù„Ø¯ÙƒØªÙˆØ±: Ø§Ø®ØªØ± Ù…Ù† ØªØ±ÙŠØ¯ Ø£Ù† ØªØ­Ù…ÙŠ</h1>
            <div class="selection-list" id="doctorSelection">
                <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ù„Ù„Ø§Ø®ØªÙŠØ§Ø± -->
            </div>
        </div>
        
        <!-- Ø§Ù„ØµÙØ­Ø© 11: Ø¯ÙˆØ± Ø§Ù„Ø´Ø§ÙŠØ¨ -->
        <div id="page11" class="page">
            <h1>Ø£Ø¹Ø· Ø§Ù„Ø¬ÙˆØ§Ù„ Ù„Ù„Ø´Ø§ÙŠØ¨</h1>
            <button id="nextToSheriff" class="btn">Ø§Ù„ØªØ§Ù„ÙŠ</button>
        </div>
        
        <!-- Ø§Ù„ØµÙØ­Ø© 12: Ø¯ÙˆØ± Ø§Ù„Ø´Ø§ÙŠØ¨ -->
        <div id="page12" class="page">
            <h1>Ø§Ù„Ø´Ø§ÙŠØ¨: Ø§Ø®ØªØ± Ù…Ù† ØªØ±ÙŠØ¯ Ø£Ù† ØªØ³Ø£Ù„ Ø¹Ù†Ù‡</h1>
            <div class="selection-list" id="sheriffSelection">
                <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ù„Ù„Ø§Ø®ØªÙŠØ§Ø± -->
            </div>
        </div>
        
        <!-- Ø§Ù„ØµÙØ­Ø© 13: Ø§Ù„ØªØµÙˆÙŠØª -->
        <div id="page13" class="page">
            <h1>ÙŠØ§ <span id="voterName"></span>ØŒ Ø§Ø®ØªØ± Ø¹Ù„Ù‰ Ù…Ù† ØªØµÙˆØª</h1>
            <div class="selection-list" id="votingSelection">
                <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ù„Ù„ØªØµÙˆÙŠØª -->
            </div>
        </div>
        
        <!-- Ø§Ù„ØµÙØ­Ø© 14: Ø§Ù„Ù†ØªÙŠØ¬Ø© -->
        <div id="page14" class="page">
            <h1>Ø§Ù„Ù…Ø§ÙÙŠØ§ Ù‡Ùˆ: <span id="impostorName" class="role-name">ÙÙ„Ø§Ù†</span></h1>
            <p class="game-status">Ù„Ù‚Ø¯ ÙƒÙØ´ÙÙØª Ù‡ÙˆÙŠØ© Ø§Ù„Ù…Ø§ÙÙŠØ§!</p>
            <div class="buttons">
                <button id="newGame" class="btn">Ù„Ø¹Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
            </div>
        </div>
    </div>

    <script>
        // ==================== Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø© ====================
        let playerName = "";
        let playerRole = "";
        let roomCode = "";
        let players = [];
        let currentPage = 1;
        let gameState = {
            mafiaChoice: "",
            doctorChoice: "",
            sheriffChoice: "",
            votes: {},
            isMafia: false
        };

        // ==================== Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ© (Ø¨Ø¯ÙˆÙ† Firebase) ====================
        let gameDatabase = {
            rooms: {},
            listeners: {},
            
            ref: function(path) {
                const self = this;
                
                return {
                    set: function(data) {
                        console.log("ğŸ’¾ Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª:", path, data);
                        self.rooms[path] = JSON.parse(JSON.stringify(data));
                        
                        // Ø¥Ø´Ø¹Ø§Ø± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªÙ…Ø¹ÙŠÙ† Ø¨Ø§Ù„ØªØ­Ø¯ÙŠØ«
                        setTimeout(() => {
                            if (self.listeners[path]) {
                                self.listeners[path].forEach(callback => {
                                    callback({ val: () => self.rooms[path] });
                                });
                            }
                        }, 100);
                        return Promise.resolve();
                    },
                    
                    update: function(data) {
                        console.log("ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª:", path, data);
                        if (!self.rooms[path]) {
                            self.rooms[path] = {};
                        }
                        Object.assign(self.rooms[path], data);
                        
                        setTimeout(() => {
                            if (self.listeners[path]) {
                                self.listeners[path].forEach(callback => {
                                    callback({ val: () => self.rooms[path] });
                                });
                            }
                        }, 100);
                        return Promise.resolve();
                    },
                    
                    on: function(event, callback) {
                        if (!self.listeners[path]) {
                            self.listeners[path] = [];
                        }
                        self.listeners[path].push(callback);
                        console.log("ğŸ‘‚ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø¹Ù„Ù‰:", path);
                        
                        // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù…Ø¨Ø§Ø´Ø±Ø©
                        if (self.rooms[path]) {
                            setTimeout(() => {
                                callback({ val: () => self.rooms[path] });
                            }, 200);
                        }
                    },
                    
                    once: function(event) {
                        return Promise.resolve({
                            val: () => self.rooms[path] || null
                        });
                    },
                    
                    child: function(childPath) {
                        return self.ref(path + '/' + childPath);
                    },
                    
                    remove: function() {
                        console.log("ğŸ—‘ï¸ Ø­Ø°Ù:", path);
                        delete self.rooms[path];
                        if (self.listeners[path]) {
                            delete self.listeners[path];
                        }
                        return Promise.resolve();
                    }
                };
            }
        };

        // ==================== Ø§Ù„Ø¹Ù†Ø§ØµØ± ====================
        const pages = document.querySelectorAll('.page');
        const playerNameInput = document.getElementById('playerName');
        const saveNameBtn = document.getElementById('saveName');
        const joinRoomBtn = document.getElementById('joinRoom');
        const createRoomBtn = document.getElementById('createRoom');
        const roomCodeDisplay = document.getElementById('roomCode');
        const startGameBtn = document.getElementById('startGame');
        const roomCodeInput = document.getElementById('roomCodeInput');
        const connectToRoomBtn = document.getElementById('connectToRoom');
        const playerNameDisplay = document.getElementById('playerNameDisplay');
        const playerNameDisplay2 = document.getElementById('playerNameDisplay2');
        const playerRoleDisplay = document.getElementById('playerRole');
        const roleRevealElement = document.getElementById('roleReveal');
        const nextToRoleBtn = document.getElementById('nextToRole');
        const nextToNightBtn = document.getElementById('nextToNight');
        const startNightBtn = document.getElementById('startNight');
        const mafiaSelection = document.getElementById('mafiaSelection');
        const nextToDoctorBtn = document.getElementById('nextToDoctor');
        const doctorSelection = document.getElementById('doctorSelection');
        const nextToSheriffBtn = document.getElementById('nextToSheriff');
        const sheriffSelection = document.getElementById('sheriffSelection');
        const voterNameDisplay = document.getElementById('voterName');
        const votingSelection = document.getElementById('votingSelection');
        const impostorNameDisplay = document.getElementById('impostorName');
        const newGameBtn = document.getElementById('newGame');
        const hostPlayerList = document.getElementById('hostPlayerList');
        const gameStatusElement = document.getElementById('gameStatus');

        // ==================== Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ====================
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ø£Ø¯ÙˆØ§Ø± Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø¹Ø¯Ø¯ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†
        function generateRoles(playerCount) {
            const roles = [];
            
            // ÙˆØ§Ø­Ø¯ ÙÙ‚Ø· Ù…Ø§ÙÙŠØ§
            roles.push("Ø§Ù„Ù…Ø§ÙÙŠØ§");
            
            // ÙˆØ§Ø­Ø¯ ÙÙ‚Ø· Ø¯ÙƒØªÙˆØ±
            roles.push("Ø§Ù„Ø¯ÙƒØªÙˆØ±");
            
            // ÙˆØ§Ø­Ø¯ ÙÙ‚Ø· Ø´Ø§ÙŠØ¨
            roles.push("Ø§Ù„Ø´Ø§ÙŠØ¨");
            
            // Ø§Ù„Ø¨Ø§Ù‚ÙŠ ÙƒÙ„Ù‡Ù… Ù…ÙˆØ§Ø·Ù†ÙŠÙ†
            for (let i = 3; i < playerCount; i++) {
                roles.push("Ø§Ù„Ù…ÙˆØ§Ø·Ù†");
            }
            
            return roles;
        }

        // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†
        function updatePlayerList() {
            hostPlayerList.innerHTML = "";
            
            players.forEach(player => {
                const playerDiv = document.createElement('div');
                playerDiv.className = 'player';
                
                // Ø¥Ø¶Ø§ÙØ© ÙØ¦Ø© Ø­Ø³Ø¨ Ø§Ù„Ø¯ÙˆØ± Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…Ø¹Ø±ÙˆÙØ§Ù‹
                if (player === playerName && playerRole) {
                    if (playerRole === "Ø§Ù„Ù…Ø§ÙÙŠØ§") {
                        playerDiv.classList.add('mafia');
                        playerDiv.textContent = player + " (Ø£Ù†Øª - Ø§Ù„Ù…Ø§ÙÙŠØ§)";
                    } else if (playerRole === "Ø§Ù„Ø¯ÙƒØªÙˆØ±") {
                        playerDiv.classList.add('doctor');
                        playerDiv.textContent = player + " (Ø£Ù†Øª - Ø§Ù„Ø¯ÙƒØªÙˆØ±)";
                    } else if (playerRole === "Ø§Ù„Ø´Ø§ÙŠØ¨") {
                        playerDiv.classList.add('sheriff');
                        playerDiv.textContent = player + " (Ø£Ù†Øª - Ø§Ù„Ø´Ø§ÙŠØ¨)";
                    } else {
                        playerDiv.classList.add('citizen');
                        playerDiv.textContent = player + " (Ø£Ù†Øª - Ù…ÙˆØ§Ø·Ù†)";
                    }
                } else {
                    playerDiv.textContent = player;
                }
                
                hostPlayerList.appendChild(playerDiv);
            });
            
            // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„ØºØ±ÙØ©
            if (gameStatusElement) {
                const playerCount = players.length;
                let statusText = `ğŸ‘¥ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙˆÙ†: ${playerCount}`;
                
                if (playerCount < 3) {
                    statusText += " - âŒ ÙŠØ­ØªØ§Ø¬ Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø£ÙƒØ«Ø±!";
                    startGameBtn.disabled = true;
                    startGameBtn.style.opacity = "0.5";
                } else {
                    statusText += " - âœ… Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¨Ø¯Ø£!";
                    startGameBtn.disabled = false;
                    startGameBtn.style.opacity = "1";
                }
                
                gameStatusElement.textContent = statusText;
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„Ø¯ÙˆØ±
        function updateRoleDisplay() {
            if (!playerRole) return;
            
            playerRoleDisplay.textContent = playerRole;
            
            // Ø¥Ø¶Ø§ÙØ© ÙØ¦Ø© CSS Ø­Ø³Ø¨ Ø§Ù„Ø¯ÙˆØ±
            roleRevealElement.className = 'role-reveal';
            
            if (playerRole === "Ø§Ù„Ù…Ø§ÙÙŠØ§") {
                roleRevealElement.classList.add('mafia');
                playerRoleDisplay.style.color = "#ff0000";
            } else if (playerRole === "Ø§Ù„Ø¯ÙƒØªÙˆØ±") {
                roleRevealElement.classList.add('doctor');
                playerRoleDisplay.style.color = "#00ff00";
            } else if (playerRole === "Ø§Ù„Ø´Ø§ÙŠØ¨") {
                roleRevealElement.classList.add('sheriff');
                playerRoleDisplay.style.color = "#0000ff";
            } else {
                roleRevealElement.classList.add('citizen');
                playerRoleDisplay.style.color = "#cccccc";
            }
        }

        // ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø£Ø¯ÙˆØ§Ø± Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†
        function distributeRolesToAllPlayers(rolesArray) {
            const roomRef = gameDatabase.ref('rooms/' + roomCode);
            
            const updates = {};
            
            // ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø£Ø¯ÙˆØ§Ø± Ø¹Ù„Ù‰ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø­Ø³Ø¨ ØªØ±ØªÙŠØ¨Ù‡Ù…
            players.forEach((player, index) => {
                const role = rolesArray[index];
                updates['players/' + player + '/role'] = role;
                
                // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ø°Ø§ Ø§Ù„Ù„Ø§Ø¹Ø¨ Ù‡Ùˆ Ø£Ù†Øª
                if (player === playerName) {
                    playerRole = role;
                    updateRoleDisplay();
                }
            });
            
            // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
            updates.status = 'started';
            updates.gameState = 'role_reveal';
            updates.currentPhase = 'night';
            
            console.log("ğŸ­ ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø£Ø¯ÙˆØ§Ø±:", updates);
            
            roomRef.update(updates)
                .then(() => {
                    console.log("âœ… ØªÙ… ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø£Ø¯ÙˆØ§Ø± Ø¨Ù†Ø¬Ø§Ø­");
                })
                .catch(error => {
                    console.error("âŒ Ø®Ø·Ø£ ÙÙŠ ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø£Ø¯ÙˆØ§Ø±:", error);
                });
        }

        // Ø¹Ø±Ø¶ ØµÙØ­Ø© Ù…Ø¹ÙŠÙ†Ø©
        function showPage(pageNumber) {
            pages.forEach(page => {
                page.classList.remove('active');
            });
            
            const targetPage = document.getElementById(`page${pageNumber}`);
            if (targetPage) {
                targetPage.classList.add('active');
                currentPage = pageNumber;
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„ØµÙØ­Ø§Øª
                if (pageNumber === 5 || pageNumber === 6) {
                    playerNameDisplay.textContent = playerName;
                    playerNameDisplay2.textContent = playerName;
                }
            }
        }

        // Ø¥Ø¹Ø¯Ø§Ø¯ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±
        function setupSelectionList(element, playersList, callback) {
            element.innerHTML = "";
            
            playersList.forEach(player => {
                const button = document.createElement('button');
                button.className = 'selection-btn';
                button.textContent = player;
                button.addEventListener('click', () => {
                    callback(player);
                });
                element.appendChild(button);
            });
        }

        // ==================== Ù…Ø¹Ø§Ù„Ø¬Ø§Øª Ø§Ù„Ø£Ø­Ø¯Ø§Ø« ====================

        // Ø­ÙØ¸ Ø§Ù„Ø§Ø³Ù…
        saveNameBtn.addEventListener('click', () => {
            if (playerNameInput.value.trim() === "") {
                alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù…Ùƒ");
                return;
            }
            
            playerName = playerNameInput.value.trim();
            showPage(2);
        });

        // Ø¥Ù†Ø´Ø§Ø¡ ØºØ±ÙØ©
        createRoomBtn.addEventListener('click', () => {
            // Ø¥Ù†Ø´Ø§Ø¡ Ø±Ù…Ø² ØºØ±ÙØ© Ø¹Ø´ÙˆØ§Ø¦ÙŠ
            roomCode = Math.floor(10000 + Math.random() * 90000).toString();
            roomCodeDisplay.textContent = roomCode;
            
            console.log("ğŸš€ Ø¥Ù†Ø´Ø§Ø¡ ØºØ±ÙØ© Ø¬Ø¯ÙŠØ¯Ø© Ø¨Ø±Ù…Ø²:", roomCode);
            
            // Ø¥Ù†Ø´Ø§Ø¡ ØºØ±ÙØ© ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            const roomRef = gameDatabase.ref('rooms/' + roomCode);
            
            // Ø¥Ø¹Ø¯Ø§Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØºØ±ÙØ©
            const roomData = {
                host: playerName,
                status: 'waiting',
                gameState: 'lobby',
                created: Date.now(),
                players: {
                    [playerName]: {
                        name: playerName,
                        role: '',
                        isHost: true,
                        isReady: false,
                        joined: Date.now()
                    }
                }
            };
            
            // Ø­ÙØ¸ Ø§Ù„ØºØ±ÙØ©
            roomRef.set(roomData)
                .then(() => {
                    console.log("âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØºØ±ÙØ© Ø¨Ù†Ø¬Ø§Ø­");
                    
                    // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª ÙÙŠ Ø§Ù„ØºØ±ÙØ©
                    roomRef.on('value', (snapshot) => {
                        const roomData = snapshot.val();
                        if (roomData) {
                            console.log("ğŸ“¡ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØºØ±ÙØ©:", roomData);
                            
                            // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†
                            if (roomData.players) {
                                players = Object.keys(roomData.players);
                                updatePlayerList();
                            }
                            
                            // Ø¥Ø°Ø§ Ø¨Ø¯Ø£Øª Ø§Ù„Ù„Ø¹Ø¨Ø©
                            if (roomData.status === 'started') {
                                // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¯ÙˆØ±ÙŠ
                                const myData = roomData.players[playerName];
                                if (myData && myData.role) {
                                    playerRole = myData.role;
                                    updateRoleDisplay();
                                }
                                
                                // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„ØµÙØ­Ø© Ø§Ù„Ø¯ÙˆØ±
                                setTimeout(() => {
                                    showPage(5);
                                }, 500);
                            }
                        }
                    });
                    
                    players = [playerName];
                    updatePlayerList();
                    showPage(3);
                })
                .catch(error => {
                    console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØºØ±ÙØ©:", error);
                    alert("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØºØ±ÙØ©");
                });
        });

        // Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ù„ØºØ±ÙØ©
        connectToRoomBtn.addEventListener('click', () => {
            if (roomCodeInput.value.trim() === "") {
                alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù…Ø² Ø§Ù„ØºØ±ÙØ©");
                return;
            }
            
            roomCode = roomCodeInput.value.trim();
            
            console.log("ğŸ” Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ù„ØºØ±ÙØ©:", roomCode);
            
            const roomRef = gameDatabase.ref('rooms/' + roomCode);
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„ØºØ±ÙØ©
            roomRef.once('value')
                .then((snapshot) => {
                    const roomData = snapshot.val();
                    if (roomData) {
                        console.log("âœ… ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„ØºØ±ÙØ©:", roomData);
                        
                        // Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ù„ØºØ±ÙØ©
                        const playerData = {
                            name: playerName,
                            role: '',
                            isHost: false,
                            isReady: false,
                            joined: Date.now()
                        };
                        
                        roomRef.child('players/' + playerName).set(playerData)
                            .then(() => {
                                console.log("âœ… ØªÙ… Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ù„ØºØ±ÙØ© Ø¨Ù†Ø¬Ø§Ø­!");
                                
                                // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª
                                roomRef.on('value', (snapshot) => {
                                    const updatedData = snapshot.val();
                                    if (updatedData) {
                                        console.log("ğŸ“¡ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØºØ±ÙØ©:", updatedData);
                                        
                                        // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†
                                        if (updatedData.players) {
                                            players = Object.keys(updatedData.players);
                                            updatePlayerList();
                                        }
                                        
                                        // Ø¥Ø°Ø§ Ø¨Ø¯Ø£Øª Ø§Ù„Ù„Ø¹Ø¨Ø©
                                        if (updatedData.status === 'started') {
                                            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¯ÙˆØ±ÙŠ
                                            const myData = updatedData.players[playerName];
                                            if (myData && myData.role) {
                                                playerRole = myData.role;
                                                updateRoleDisplay();
                                            }
                                            
                                            // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„ØµÙØ­Ø© Ø§Ù„Ø¯ÙˆØ±
                                            setTimeout(() => {
                                                showPage(5);
                                            }, 500);
                                        }
                                    }
                                });
                                
                                alert("âœ… ØªÙ… Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ù„ØºØ±ÙØ© Ø¨Ù†Ø¬Ø§Ø­!");
                                showPage(3);
                            });
                    } else {
                        alert("âŒ Ø§Ù„ØºØ±ÙØ© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©!");
                    }
                })
                .catch(error => {
                    console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ù„ØºØ±ÙØ©:", error);
                    alert("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ù„ØºØ±ÙØ©");
                });
        });

        // Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©
        startGameBtn.addEventListener('click', () => {
            if (players.length < 3) {
                alert("ÙŠØ­ØªØ§Ø¬ 3 Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©!");
                return;
            }
            
         console.log("ğŸ® Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø© Ù…Ø¹ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†:", players);
                 // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø£Ø¯ÙˆØ§Ø± Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø¹Ø¯Ø¯ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†
        const roleList = generateRoles(players.length);
        const shuffledRoles = [...roleList].sort(() => Math.random() - 0.5);
        
        console.log("ğŸ­ Ø§Ù„Ø£Ø¯ÙˆØ§Ø± Ø§Ù„Ù…Ø®Ù„ÙˆØ·Ø©:", shuffledRoles);
        
        const roomRef = gameDatabase.ref('rooms/' + roomCode);
        
        // ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø£Ø¯ÙˆØ§Ø±
        const updates = {};
        players.forEach((player, index) => {
            const role = shuffledRoles[index];
            updates['players/' + player + '/role'] = role;
            
            // Ø¥Ø°Ø§ ÙƒÙ†Øª Ø£Ù†Ø§ØŒ Ø§Ø­ÙØ¸ Ø¯ÙˆØ±ÙŠ
            if (player === playerName) {
                playerRole = role;
                updateRoleDisplay();
            }
        });
        
        // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
        updates.status = 'started';
        updates.gameState = 'role_reveal';
        updates.currentPhase = 'night';
        
        roomRef.update(updates)
            .then(() => {
                console.log("âœ… Ø¨Ø¯Ø£Øª Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¨Ù†Ø¬Ø§Ø­");
                showPage(5);
            })
            .catch(error => {
                console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©:", error);
                alert("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©");
            });
    });

    // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ ÙƒØ´Ù Ø§Ù„Ø´Ø®ØµÙŠØ©
    nextToRoleBtn.addEventListener('click', () => {
        showPage(6);
    });

    // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ Ø§Ù„Ù„ÙŠÙ„
    nextToNightBtn.addEventListener('click', () => {
        showPage(7);
    });

    // Ø¨Ø¯Ø¡ Ø§Ù„Ù„ÙŠÙ„
    startNightBtn.addEventListener('click', () => {
        // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù„Ø¹Ø¨ Ù‡Ùˆ Ø§Ù„Ù…Ø§ÙÙŠØ§ØŒ ÙŠØ¸Ù‡Ø± Ù„Ù‡ ØµÙØ­Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¶Ø­ÙŠØ©
        if (playerRole === "Ø§Ù„Ù…Ø§ÙÙŠØ§") {
            gameState.isMafia = true;
            setupMafiaSelection();
            showPage(8);
        } else {
            // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…Ø§ÙÙŠØ§ØŒ ÙŠÙ†ØªÙ‚Ù„ Ù…Ø¨Ø§Ø´Ø±Ø© Ø¥Ù„Ù‰ ØµÙØ­Ø© Ø§Ù„Ø¯ÙƒØªÙˆØ±
            showPage(9);
        }
    });

    // Ø¥Ø¹Ø¯Ø§Ø¯ Ù‚Ø§Ø¦Ù…Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø§ÙÙŠØ§
    function setupMafiaSelection() {
        mafiaSelection.innerHTML = "";
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ø¨Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø¨Ø§Ø³ØªØ«Ù†Ø§Ø¡ Ø§Ù„Ù…Ø§ÙÙŠØ§ Ù†ÙØ³Ù‡
        const otherPlayers = players.filter(player => player !== playerName);
        
        if (otherPlayers.length === 0) {
            mafiaSelection.innerHTML = "<p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø¢Ø®Ø±ÙŠÙ† Ù„Ù„Ø§Ø®ØªÙŠØ§Ø±!</p>";
            return;
        }
        
        otherPlayers.forEach(player => {
            const button = document.createElement('button');
            button.className = 'selection-btn';
            button.textContent = player;
            button.addEventListener('click', () => {
                gameState.mafiaChoice = player;
                alert("Ù„Ù‚Ø¯ Ø§Ø®ØªØ±Øª " + player + " ÙƒØ¶Ø­ÙŠØ©.");
                
                // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ Ø¯ÙˆØ± Ø§Ù„Ø¯ÙƒØªÙˆØ±
                showPage(9);
            });
            mafiaSelection.appendChild(button);
        });
    }

    // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ Ø¯ÙˆØ± Ø§Ù„Ø¯ÙƒØªÙˆØ±
    nextToDoctorBtn.addEventListener('click', () => {
        // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù„Ø¹Ø¨ Ù‡Ùˆ Ø§Ù„Ø¯ÙƒØªÙˆØ±ØŒ ÙŠØ¸Ù‡Ø± Ù„Ù‡ ØµÙØ­Ø© Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±
        if (playerRole === "Ø§Ù„Ø¯ÙƒØªÙˆØ±") {
            setupDoctorSelection();
            showPage(10);
        } else {
            // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ø¯ÙƒØªÙˆØ±ØŒ ÙŠÙ†ØªÙ‚Ù„ Ø¥Ù„Ù‰ Ø¯ÙˆØ± Ø§Ù„Ø´Ø§ÙŠØ¨
            showPage(11);
        }
    });

    // Ø¥Ø¹Ø¯Ø§Ø¯ Ù‚Ø§Ø¦Ù…Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¯ÙƒØªÙˆØ±
    function setupDoctorSelection() {
        doctorSelection.innerHTML = "";
        
        if (players.length === 0) {
            doctorSelection.innerHTML = "<p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù„Ø§Ø¹Ø¨ÙŠÙ† Ù„Ù„Ø§Ø®ØªÙŠØ§Ø±!</p>";
            return;
        }
        
        players.forEach(player => {
            const button = document.createElement('button');
            button.className = 'selection-btn';
            button.textContent = player;
            button.addEventListener('click', () => {
                gameState.doctorChoice = player;
                alert("Ù„Ù‚Ø¯ Ø§Ø®ØªØ±Øª Ø­Ù…Ø§ÙŠØ© " + player + ".");
                
                // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ Ø¯ÙˆØ± Ø§Ù„Ø´Ø§ÙŠØ¨
                showPage(11);
            });
            doctorSelection.appendChild(button);
        });
    }

    // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ Ø¯ÙˆØ± Ø§Ù„Ø´Ø§ÙŠØ¨
    nextToSheriffBtn.addEventListener('click', () => {
        // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù„Ø¹Ø¨ Ù‡Ùˆ Ø§Ù„Ø´Ø§ÙŠØ¨ØŒ ÙŠØ¸Ù‡Ø± Ù„Ù‡ ØµÙØ­Ø© Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±
        if (playerRole === "Ø§Ù„Ø´Ø§ÙŠØ¨") {
            setupSheriffSelection();
            showPage(12);
        } else {
            // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ø´Ø§ÙŠØ¨ØŒ ÙŠÙ†ØªÙ‚Ù„ Ø¥Ù„Ù‰ Ø§Ù„ØªØµÙˆÙŠØª
            startVoting();
        }
    });

    // Ø¥Ø¹Ø¯Ø§Ø¯ Ù‚Ø§Ø¦Ù…Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø´Ø§ÙŠØ¨
    function setupSheriffSelection() {
        sheriffSelection.innerHTML = "";
        
        if (players.length === 0) {
            sheriffSelection.innerHTML = "<p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù„Ø§Ø¹Ø¨ÙŠÙ† Ù„Ù„Ø§Ø®ØªÙŠØ§Ø±!</p>";
            return;
        }
        
        players.forEach(player => {
            const button = document.createElement('button');
            button.className = 'selection-btn';
            button.textContent = player;
            button.addEventListener('click', () => {
                gameState.sheriffChoice = player;
                
                // ÙÙŠ Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©ØŒ Ø§Ù„Ø´Ø§ÙŠØ¨ ÙŠØ¹Ø±Ù Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø´Ø®Øµ Ù…Ø§ÙÙŠØ§ Ø£Ù… Ù„Ø§
                const isMafia = Math.random() > 0.5; // Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ù„Ø£ØºØ±Ø§Ø¶ Ø§Ù„Ø¹Ø±Ø¶
                alert("Ù„Ù‚Ø¯ Ø§Ø®ØªØ±Øª Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† " + player + ".\n" + 
                      (isMafia ? "Ù‡Ø°Ø§ Ø§Ù„Ø´Ø®Øµ Ù‡Ùˆ Ø§Ù„Ù…Ø§ÙÙŠØ§!" : "Ù‡Ø°Ø§ Ø§Ù„Ø´Ø®Øµ Ù„ÙŠØ³ Ù…Ø§ÙÙŠØ§."));
                
                // Ø¨Ø¯Ø¡ Ø§Ù„ØªØµÙˆÙŠØª
                startVoting();
            });
            sheriffSelection.appendChild(button);
        });
    }

    // Ø¨Ø¯Ø¡ Ø§Ù„ØªØµÙˆÙŠØª
    function startVoting() {
        // ØªØ¹ÙŠÙŠÙ† Ø§Ø³Ù… Ø§Ù„Ù…ØµÙˆØª
        voterNameDisplay.textContent = playerName;
        
        // Ø¥Ø¹Ø¯Ø§Ø¯ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØµÙˆÙŠØª
        setupVotingSelection();
        
        showPage(13);
    }

    // Ø¥Ø¹Ø¯Ø§Ø¯ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØµÙˆÙŠØª
    function setupVotingSelection() {
        votingSelection.innerHTML = "";
        
        if (players.length === 0) {
            votingSelection.innerHTML = "<p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù„Ø§Ø¹Ø¨ÙŠÙ† Ù„Ù„ØªØµÙˆÙŠØª!</p>";
            return;
        }
        
        players.forEach(player => {
            if (player === playerName) return; // Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØµÙˆÙŠØª Ø¹Ù„Ù‰ Ù†ÙØ³Ùƒ
            
            const button = document.createElement('button');
            button.className = 'selection-btn';
            button.textContent = player;
            button.addEventListener('click', () => {
                gameState.votes[playerName] = player;
                alert("Ù„Ù‚Ø¯ ØµÙˆØªØª Ø¶Ø¯ " + player + ".");
                
                // Ù…Ø­Ø§ÙƒØ§Ø© ØªØµÙˆÙŠØª Ø§Ù„Ø¢Ø®Ø±ÙŠÙ†
                simulateOtherVotes();
                
                // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø©
                showResult();
            });
            votingSelection.appendChild(button);
        });
    }

    // Ù…Ø­Ø§ÙƒØ§Ø© ØªØµÙˆÙŠØª Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø§Ù„Ø¢Ø®Ø±ÙŠÙ†
    function simulateOtherVotes() {
        const otherPlayers = players.filter(p => p !== playerName);
        
        otherPlayers.forEach(player => {
            const randomPlayer = players[Math.floor(Math.random() * players.length)];
            gameState.votes[player] = randomPlayer;
        });
        
        console.log("ğŸ—³ï¸ Ø§Ù„Ø£ØµÙˆØ§Øª Ø§Ù„Ù…Ø­Ø§ÙƒØ§Ø©:", gameState.votes);
    }

    // Ø¹Ø±Ø¶ Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
    function showResult() {
        // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø£ØµÙˆØ§Øª
        const voteCount = {};
        players.forEach(player => {
            const votedPlayer = gameState.votes[player];
            if (votedPlayer) {
                voteCount[votedPlayer] = (voteCount[votedPlayer] || 0) + 1;
            }
        });
        
        // Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ø£ÙƒØ«Ø± ØªØµÙˆÙŠØªÙ‹Ø§
        let maxVotes = 0;
        let impostor = "";
        
        for (const [player, votes] of Object.entries(voteCount)) {
            if (votes > maxVotes) {
                maxVotes = votes;
                impostor = player;
            }
        }
        
        // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù‡Ù†Ø§Ùƒ Ø£ØµÙˆØ§ØªØŒ Ù†Ø®ØªØ§Ø± Ø¹Ø´ÙˆØ§Ø¦ÙŠÙ‹Ø§
        if (impostor === "") {
            impostor = players[Math.floor(Math.random() * players.length)];
        }
        
        // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø©
        impostorNameDisplay.textContent = impostor;
        showPage(14);
    }

    // Ù„Ø¹Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø©
    newGameBtn.addEventListener('click', () => {
        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù„Ø¹Ø¨Ø©
        resetGame();
        showPage(1);
    });

    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù„Ø¹Ø¨Ø©
    function resetGame() {
        if (roomCode) {
            const roomRef = gameDatabase.ref('rooms/' + roomCode);
            roomRef.remove();
        }
        
        playerName = "";
        playerRole = "";
        roomCode = "";
        players = [];
        gameState = {
            mafiaChoice: "",
            doctorChoice: "",
            sheriffChoice: "",
            votes: {},
            isMafia: false
        };
        
        playerNameInput.value = "";
        roomCodeInput.value = "";
        playerRoleDisplay.textContent = "Ø§Ù„Ù…ÙˆØ§Ø·Ù†";
        roleRevealElement.className = 'role-reveal';
        
        updatePlayerList();
        
        console.log("ğŸ”„ ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù„Ø¹Ø¨Ø©");
    }

    // Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±: Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Enter ÙÙŠ Ø­Ù‚Ù„ Ø§Ù„Ø§Ø³Ù…
    playerNameInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            saveNameBtn.click();
        }
    });

    // Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±: Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Enter ÙÙŠ Ø­Ù‚Ù„ Ø±Ù…Ø² Ø§Ù„ØºØ±ÙØ©
    roomCodeInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            connectToRoomBtn.click();
        }
    });

    // ØªÙ‡ÙŠØ¦Ø© Ø£ÙˆÙ„ÙŠØ©
    window.addEventListener('DOMContentLoaded', () => {
        // Ø¥Ø¶Ø§ÙØ© Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø§ÙØªØ±Ø§Ø¶ÙŠÙŠÙ† Ù„Ù„Ø¹Ø±Ø¶
        players = ["Ø£Ø­Ù…Ø¯", "Ù…Ø­Ù…Ø¯", "ÙØ§Ø·Ù…Ø©", "Ø®Ø§Ù„Ø¯", "Ø³Ø§Ø±Ø©"];
        
        // Ø¹Ø±Ø¶ ØªØ£Ø«ÙŠØ±Ø§Øª Ø¯Ù… Ø¥Ø¶Ø§ÙÙŠØ©
        addBloodEffects();
        
        console.log("ğŸ® Ù„Ø¹Ø¨Ø© Ø§Ù„Ù…Ø§ÙÙŠØ§ Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„ØªØ´ØºÙŠÙ„!");
    });

    // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ±Ø§Øª Ø¯Ù… Ø¥Ø¶Ø§ÙÙŠØ©
    function addBloodEffects() {
        const container = document.querySelector('.container');
        
        for (let i = 0; i < 5; i++) {
            const drip = document.createElement('div');
            drip.className = 'blood-drip';
            drip.style.left = Math.random() * 100 + '%';
            drip.style.top = Math.random() * 50 + '%';
            drip.style.height = (20 + Math.random() * 50) + 'px';
            drip.style.opacity = 0.3 + Math.random() * 0.4;
            container.appendChild(drip);
        }
    }

    // Ø¯Ø§Ù„Ø© Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Ø§Ù„ØºØ±ÙØ©
    function leaveRoom() {
        if (roomCode) {
            const roomRef = gameDatabase.ref('rooms/' + roomCode);
            roomRef.child('players/' + playerName).remove();
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„ØºØ±ÙØ© ÙØ§Ø±ØºØ© Ù„Ø­Ø°ÙÙ‡Ø§
            roomRef.once('value').then((snapshot) => {
                const roomData = snapshot.val();
                if (roomData && Object.keys(roomData.players).length === 0) {
                    roomRef.remove();
                }
            });
        }
    }

    // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„Ø¯Ø§Ù„Ø© Ø¹Ù†Ø¯ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØµÙØ­Ø©
    window.addEventListener('beforeunload', leaveRoom);
</script>