<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لعبة المافيا</title>
    <style>
        /* تنسيقات عامة */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #000;
            color: #fff;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(100, 0, 0, 0.1) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(100, 0, 0, 0.1) 0%, transparent 20%);
            overflow-x: hidden;
        }
        
        /* تأثير الدم الخفيف */
        .blood-effect {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
            opacity: 0.05;
            background-image: 
                url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M50,20 C55,10 65,10 70,20 C75,30 80,40 75,50 C70,60 60,70 50,75 C40,70 30,60 25,50 C20,40 25,30 30,20 C35,10 45,10 50,20 Z' fill='%23ff0000'/%3E%3C/svg%3E"),
                url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M30,15 C35,5 45,5 50,15 C55,25 60,35 55,45 C50,55 40,65 30,70 C20,65 10,55 5,45 C0,35 5,25 10,15 C15,5 25,5 30,15 Z' fill='%23aa0000'/%3E%3C/svg%3E");
            background-size: 150px, 120px;
            background-position: 10% 20%, 80% 70%;
        }
        
        /* الصفحات */
        .page {
            display: none;
            width: 100%;
            max-width: 800px;
            background-color: rgba(20, 0, 0, 0.9);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 0 30px rgba(255, 0, 0, 0.3);
            border: 2px solid #800000;
            text-align: center;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .active {
            display: block;
        }
        
        /* العنوان */
        .page-title {
            color: #ff0000;
            font-size: 2.8rem;
            margin-bottom: 30px;
            text-shadow: 0 0 10px rgba(255, 0, 0, 0.5);
            position: relative;
            padding-bottom: 15px;
        }
        
        .page-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 20%;
            right: 20%;
            height: 3px;
            background: linear-gradient(90deg, transparent, #ff0000, transparent);
        }
        
        /* النص */
        .page-text {
            font-size: 1.4rem;
            margin-bottom: 30px;
            line-height: 1.6;
            color: #e0e0e0;
        }
        
        .highlight {
            color: #ff3333;
            font-weight: bold;
        }
        
        /* الحقول والإدخال */
        .input-container {
            margin: 25px 0;
        }
        
        input {
            width: 70%;
            padding: 15px;
            font-size: 1.2rem;
            background-color: rgba(0, 0, 0, 0.7);
            border: 2px solid #800000;
            border-radius: 8px;
            color: white;
            text-align: center;
            margin-bottom: 10px;
        }
        
        input:focus {
            outline: none;
            border-color: #ff0000;
            box-shadow: 0 0 10px rgba(255, 0, 0, 0.5);
        }
        
        /* الأزرار */
        .buttons-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
        }
        
        button {
            background: linear-gradient(to bottom, #800000, #500000);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.2rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 180px;
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
            border: 1px solid #a00000;
        }
        
        button:hover {
            background: linear-gradient(to bottom, #a00000, #700000);
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.7);
        }
        
        button:active {
            transform: translateY(1px);
        }
        
        .primary-btn {
            background: linear-gradient(to bottom, #ff0000, #800000);
            border: 1px solid #ff3333;
        }
        
        .primary-btn:hover {
            background: linear-gradient(to bottom, #ff3333, #a00000);
        }
        
        /* قائمة اللاعبين */
        .players-list {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin: 30px 0;
        }
        
        .player-card {
            background-color: rgba(40, 0, 0, 0.8);
            border: 2px solid #800000;
            border-radius: 8px;
            padding: 15px;
            min-width: 150px;
            transition: all 0.3s;
        }
        
        .player-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(255, 0, 0, 0.2);
            border-color: #ff0000;
        }
        
        .player-card.selected {
            background-color: rgba(100, 0, 0, 0.9);
            border-color: #ff0000;
            box-shadow: 0 0 15px rgba(255, 0, 0, 0.5);
        }
        
        .player-name {
            font-size: 1.2rem;
            font-weight: bold;
            color: #fff;
        }
        
        .player-role {
            font-size: 1rem;
            color: #ff9999;
            margin-top: 5px;
        }
        
        /* الرمز العشوائي */
        .room-code {
            font-size: 3rem;
            font-weight: bold;
            color: #ff0000;
            text-shadow: 0 0 10px rgba(255, 0, 0, 0.7);
            letter-spacing: 5px;
            margin: 20px 0;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #800000;
            display: inline-block;
        }
        
        /* الدور */
        .role-display {
            background-color: rgba(0, 0, 0, 0.7);
            border: 3px solid #ff0000;
            border-radius: 10px;
            padding: 25px;
            margin: 30px auto;
            max-width: 500px;
            box-shadow: 0 0 20px rgba(255, 0, 0, 0.4);
        }
        
        .role-name {
            font-size: 2.2rem;
            color: #ff3333;
            margin: 15px 0;
            text-transform: uppercase;
        }
        
        /* التذييل */
        .footer {
            margin-top: 40px;
            color: #888;
            font-size: 0.9rem;
        }
        
        /* التكيف مع الشاشات الصغيرة */
        @media (max-width: 768px) {
            .page {
                padding: 20px;
            }
            
            .page-title {
                font-size: 2.2rem;
            }
            
            .page-text {
                font-size: 1.2rem;
            }
            
            .room-code {
                font-size: 2.2rem;
            }
            
            .buttons-container {
                flex-direction: column;
                align-items: center;
            }
            
            button {
                width: 100%;
                max-width: 300px;
            }
            
            .player-card {
                min-width: 120px;
            }
        }
    </style>
</head>
<body>
    <!-- تأثير الدم في الخلفية -->
    <div class="blood-effect"></div>
    
    <!-- الصفحة 1: إدخال الاسم -->
    <div id="page1" class="page active">
        <h1 class="page-title">لعبة المافيا</h1>
        <p class="page-text">اكتب اسمك</p>
        
        <div class="input-container">
            <input type="text" id="playerName" placeholder="اسمك هنا" maxlength="15">
        </div>
        
        <div class="buttons-container">
            <button id="saveNameBtn" class="primary-btn">حفظ الاسم والمتابعة</button>
        </div>
        
        <div class="footer">
            لعبة المافيا - ثيم أحمر وأسود
        </div>
    </div>
    
    <!-- الصفحة 2: القائمة الرئيسية -->
    <div id="page2" class="page">
        <h1 class="page-title">أهلاً بك في لعبة المافيا</h1>
        <p class="page-text">مرحباً <span id="welcomeName" class="highlight">[اسم اللاعب]</span>! اختر خياراً للبدء:</p>
        
        <div class="buttons-container">
            <button id="joinRoomBtn" class="primary-btn">انضم لغرفة</button>
            <button id="createRoomBtn">أنشئ غرفة</button>
        </div>
        
        <div class="footer">
            يمكنك الانضمام إلى غرفة موجودة أو إنشاء غرفة جديدة
        </div>
    </div>
    
    <!-- الصفحة 3: إنشاء غرفة -->
    <div id="page3" class="page">
        <h1 class="page-title">إنشاء غرفة جديدة</h1>
        <p class="page-text">قم بدعوة أصدقائك للانضمام إلى غرفتك باستخدام الرمز التالي:</p>
        
        <div class="room-code" id="roomCode">12345</div>
        
        <p class="page-text">شارك هذا الرقم مع أصدقائك للانضمام إلى غرفتك</p>
        
        <div class="players-list" id="roomPlayersList">
            <!-- سيتم إضافة اللاعبين هنا -->
        </div>
        
        <div class="buttons-container">
            <button id="startGameBtn" class="primary-btn">ابدأ اللعبة</button>
            <button id="backToMain2">رجوع</button>
        </div>
        
        <div class="footer">
            انتظر حتى ينضم اللاعبون ثم ابدأ اللعبة
        </div>
    </div>
    
    <!-- الصفحة 4: الانضمام إلى غرفة -->
    <div id="page4" class="page">
        <h1 class="page-title">الانضمام إلى غرفة</h1>
        <p class="page-text">أدخل رمز الغرفة للانضمام:</p>
        
        <div class="input-container">
            <input type="text" id="joinRoomCode" placeholder="أدخل الرمز المكون من 5 أرقام" maxlength="5" pattern="[0-9]*">
        </div>
        
        <div class="buttons-container">
            <button id="confirmJoinBtn" class="primary-btn">الانضمام</button>
            <button id="backToMain">رجوع</button>
        </div>
        
        <div class="footer">
            تأكد من صحة الرمز قبل الانضمام
        </div>
    </div>
    
    <!-- الصفحة 5: اختيار الدور -->
    <div id="page5" class="page">
        <h1 class="page-title">اختيار الدور</h1>
        <p class="page-text" id="roleMessage">دورك يا <span class="highlight" id="currentPlayerName">[الاسم]</span>، شوف شخصيتك</p>
        
        <div class="buttons-container">
            <button id="nextRoleBtn" class="primary-btn">التالي</button>
        </div>
        
        <div class="footer">
            اضغط على "التالي" للمتابعة
        </div>
    </div>
    
    <!-- الصفحة 6: عرض الدور -->
    <div id="page6" class="page">
        <h1 class="page-title">شخصيتك</h1>
        
        <div class="role-display">
            <p class="page-text">يا <span class="highlight" id="rolePlayerName">[الاسم]</span>، أنت:</p>
            <div class="role-name" id="playerRole">[الدور]</div>
            <p class="page-text" id="roleDescription">[وصف الدور]</p>
        </div>
        
        <div class="buttons-container">
            <button id="nextPlayerBtn" class="primary-btn">التالي</button>
        </div>
        
        <div class="footer">
            تذكر دورك جيداً ولا تخبر أحداً به
        </div>
    </div>
    
    <!-- الصفحة 7: نهاية اختيار الأدوار -->
    <div id="page7" class="page">
        <h1 class="page-title">انتهاء الاختيار</h1>
        <p class="page-text">لقد انتهى اختيار الشخصيات</p>
        
        <div class="players-list" id="finalPlayersList">
            <!-- سيتم عرض اللاعبين وأدوارهم هنا -->
        </div>
        
        <div class="buttons-container">
            <button id="startNightBtn" class="primary-btn">ابدأ النوم</button>
        </div>
        
        <div class="footer">
            الليل قد حل... احذروا المافيا!
        </div>
    </div>
    
    <!-- الصفحة 8: دور المافيا -->
    <div id="page8" class="page">
        <h1 class="page-title">دور المافيا</h1>
        <p class="page-text">المافيا، من تريدون ذبحه؟</p>
        
        <div class="players-list" id="mafiaTargetList">
            <!-- سيتم عرض اللاعبين (بدون المافيا) هنا -->
        </div>
        
        <div class="buttons-container">
            <button id="confirmMafiaBtn" class="primary-btn">تأكيد الاختيار</button>
        </div>
        
        <div class="footer">
            اختر بحذر... هذه فرصتكم للتخلص من الخصوم
        </div>
    </div>
    
    <!-- الصفحة 9: دور الدكتور -->
    <div id="page9" class="page">
        <h1 class="page-title">دور الدكتور</h1>
        <p class="page-text">أعط الجوال للدكتور</p>
        <p class="page-text">الدكتور، اختر من تحمي:</p>
        
        <div class="players-list" id="doctorTargetList">
            <!-- سيتم عرض اللاعبين هنا -->
        </div>
        
        <div class="buttons-container">
            <button id="confirmDoctorBtn" class="primary-btn">تأكيد الاختيار</button>
        </div>
        
        <div class="footer">
            يمكنك حماية نفسك أو أي لاعب آخر
        </div>
    </div>
    
    <!-- الصفحة 10: دور الشايب -->
    <div id="page10" class="page">
        <h1 class="page-title">دور الشايب</h1>
        <p class="page-text">أعط الجوال للشايب</p>
        <p class="page-text">الشايب، اختر من تسأل:</p>
        
        <div class="players-list" id="elderTargetList">
            <!-- سيتم عرض اللاعبين هنا -->
        </div>
        
        <div class="buttons-container">
            <button id="confirmElderBtn" class="primary-btn">تأكيد الاختيار</button>
        </div>
        
        <div class="footer">
            اختر لاعباً لتعرف إن كان من المافيا أم لا
        </div>
    </div>
    
    <!-- الصفحة 11: التصويت -->
    <div id="page11" class="page">
        <h1 class="page-title">التصويت</h1>
        <p class="page-text" id="voteMessage">يا <span class="highlight" id="votingPlayerName">[الاسم]</span>، اختر على من تصوت:</p>
        
        <div class="players-list" id="voteTargetList">
            <!-- سيتم عرض اللاعبين هنا -->
        </div>
        
        <div class="buttons-container">
            <button id="confirmVoteBtn" class="primary-btn">تأكيد التصويت</button>
        </div>
        
        <div class="footer">
            صوت على الشخص الذي تعتقد أنه من المافيا
        </div>
    </div>
    
    <!-- الصفحة 12: نتيجة اللعبة -->
    <div id="page12" class="page">
        <h1 class="page-title">نتيجة اللعبة</h1>
        <p class="page-text" id="gameResultMessage">الإمبوستر هو <span class="highlight" id="imposterName">[الاسم]</span></p>
        
        <div class="players-list" id="resultPlayersList">
            <!-- سيتم عرض اللاعبين وأدوارهم هنا -->
        </div>
        
        <div class="buttons-container">
            <button id="newGameBtn" class="primary-btn">لعبة جديدة</button>
        </div>
        
        <div class="footer">
            شكراً للعب! هل تريدون جولة أخرى؟
        </div>
    </div>

    <script>
        // البيانات والمتغيرات
        let playerName = "";
        let currentPage = 1;
        let roomCode = "";
        let players = [];
        let currentPlayerIndex = 0;
        let currentVoterIndex = 0;
        let roles = ["المافيا", "الشايب", "الدكتور", "المواطن", "المواطن", "المواطن"];
        let playerRoles = {};
        let mafiaTarget = "";
        let doctorTarget = "";
        let elderTarget = "";
        let votes = {};
        let eliminatedPlayers = [];
        
        // توليد رمز غرفة عشوائي
        function generateRoomCode() {
            return Math.floor(10000 + Math.random() * 90000).toString();
        }
        
        // تغيير الصفحة
        function changePage(pageNumber) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(`page${pageNumber}`).classList.add('active');
            currentPage = pageNumber;
            
            // تحديث محتوى الصفحات حسب الحاجة
            updatePageContent(pageNumber);
        }
        
        // تحديث محتوى الصفحة
        function updatePageContent(pageNumber) {
            switch(pageNumber) {
                case 2:
                    document.getElementById('welcomeName').textContent = playerName;
                    break;
                case 3:
                    // إنشاء رمز الغرفة إذا لم يكن موجوداً
                    if (!roomCode) {
                        roomCode = generateRoomCode();
                        document.getElementById('roomCode').textContent = roomCode;
                    }
                    updateRoomPlayers();
                    break;
                case 5:
                    document.getElementById('currentPlayerName').textContent = players[currentPlayerIndex];
                    break;
                case 6:
                    document.getElementById('rolePlayerName').textContent = players[currentPlayerIndex];
                    document.getElementById('playerRole').textContent = playerRoles[players[currentPlayerIndex]];
                    
                    // إضافة وصف الدور
                    const roleDescriptions = {
                        "المافيا": "أنت قاتل متخفي. مهمتك هي التخلص من جميع اللاعبين الآخرين دون أن يكتشفوك.",
                        "الشايب": "أنت المحقق الحكيم. يمكنك التحقق من هوية لاعب واحد كل ليلة لمعرفة ما إذا كان من المافيا.",
                        "الدكتور": "أنت المنقذ. يمكنك حماية لاعب واحد كل ليلة من هجوم المافيا.",
                        "المواطن": "أنت مواطن بريء. مهمتك هي اكتشاف المافيا والتخلص منهم عن طريق التصويت."
                    };
                    document.getElementById('roleDescription').textContent = roleDescriptions[playerRoles[players[currentPlayerIndex]]] || "";
                    break;
                case 7:
                    updateFinalPlayersList();
                    break;
                case 8:
                    updateMafiaTargetList();
                    break;
                case 9:
                    updateDoctorTargetList();
                    break;
                case 10:
                    updateElderTargetList();
                    break;
                case 11:
                    document.getElementById('votingPlayerName').textContent = players[currentVoterIndex];
                    updateVoteTargetList();
                    break;
                case 12:
                    updateGameResult();
                    break;
            }
        }
        
        // تحديث قائمة اللاعبين في الغرفة
        function updateRoomPlayers() {
            const playersList = document.getElementById('roomPlayersList');
            playersList.innerHTML = '';
            
            // إضافة المضيف أولاً
            const hostCard = document.createElement('div');
            hostCard.className = 'player-card';
            hostCard.innerHTML = `
                <div class="player-name">${playerName}</div>
                <div class="player-role">المضيف</div>
            `;
            playersList.appendChild(hostCard);
            
            // إضافة لاعبين وهميين (للتجربة)
            if (players.length === 0) {
                const dummyPlayers = ["خالد", "سارة", "فهد", "نورة", "عمر"];
                dummyPlayers.forEach(name => {
                    if (name !== playerName) {
                        const playerCard = document.createElement('div');
                        playerCard.className = 'player-card';
                        playerCard.innerHTML = `
                            <div class="player-name">${name}</div>
                            <div class="player-role">في انتظار الدور</div>
                        `;
                        playersList.appendChild(playerCard);
                        players.push(name);
                    }
                });
            } else {
                // عرض اللاعبين الحقيقيين
                players.forEach(name => {
                    if (name !== playerName) {
                        const playerCard = document.createElement('div');
                        playerCard.className = 'player-card';
                        playerCard.innerHTML = `
                            <div class="player-name">${name}</div>
                            <div class="player-role">في انتظار الدور</div>
                        `;
                        playersList.appendChild(playerCard);
                    }
                });
            }
        }
        
        // تحديث قائمة اللاعبين النهائية
        function updateFinalPlayersList() {
            const finalList = document.getElementById('finalPlayersList');
            finalList.innerHTML = '';
            
            players.forEach(name => {
                const playerCard = document.createElement('div');
                playerCard.className = 'player-card';
                playerCard.innerHTML = `
                    <div class="player-name">${name}</div>
                    <div class="player-role">${playerRoles[name]}</div>
                `;
                finalList.appendChild(playerCard);
            });
        }
        
        // تحديث قائمة أهداف المافيا
        function updateMafiaTargetList() {
            const mafiaList = document.getElementById('mafiaTargetList');
            mafiaList.innerHTML = '';
            
            // تصفية اللاعبين (إزالة المافيا)
            const targets = players.filter(name => playerRoles[name] !== "المافيا");
            
            targets.forEach(name => {
                const playerCard = document.createElement('div');
                playerCard.className = 'player-card';
                playerCard.dataset.name = name;
                playerCard.innerHTML = `
                    <div class="player-name">${name}</div>
                `;
                
                playerCard.addEventListener('click', () => {
                    document.querySelectorAll('#mafiaTargetList .player-card').forEach(card => {
                        card.classList.remove('selected');
                    });
                    playerCard.classList.add('selected');
                    mafiaTarget = name;
                });
                
                mafiaList.appendChild(playerCard);
            });
        }
        
        // تحديث قائمة أهداف الدكتور
        function updateDoctorTargetList() {
            const doctorList = document.getElementById('doctorTargetList');
            doctorList.innerHTML = '';
            
            players.forEach(name => {
                const playerCard = document.createElement('div');
                playerCard.className = 'player-card';
                playerCard.dataset.name = name;
                playerCard.innerHTML = `
                    <div class="player-name">${name}</div>
                `;
                
                playerCard.addEventListener('click', () => {
                    document.querySelectorAll('#doctorTargetList .player-card').forEach(card => {
                        card.classList.remove('selected');
                    });
                    playerCard.classList.add('selected');
                    doctorTarget = name;
                });
                
                doctorList.appendChild(playerCard);
            });
        }
        
        // تحديث قائمة أهداف الشايب
        function updateElderTargetList() {
            const elderList = document.getElementById('elderTargetList');
            elderList.innerHTML = '';
            
            players.forEach(name => {
                const playerCard = document.createElement('div');
                playerCard.className = 'player-card';
                playerCard.dataset.name = name;
                playerCard.innerHTML = `
                    <div class="player-name">${name}</div>
                `;
                
                playerCard.addEventListener('click', () => {
                    document.querySelectorAll('#elderTargetList .player-card').forEach(card => {
                        card.classList.remove('selected');
                    });
                    playerCard.classList.add('selected');
                    elderTarget = name;
                });
                
                elderList.appendChild(playerCard);
            });
        }
        
        // تحديث قائمة أهداف التصويت
        function updateVoteTargetList() {
            const voteList = document.getElementById('voteTargetList');
            voteList.innerHTML = '';
            
            // استبعاد اللاعب المصوت
            const targets = players.filter(name => name !== players[currentVoterIndex]);
            
            targets.forEach(name => {
                const playerCard = document.createElement('div');
                playerCard.className = 'player-card';
                playerCard.dataset.name = name;
                playerCard.innerHTML = `
                    <div class="player-name">${name}</div>
                `;
                
                playerCard.addEventListener('click', () => {
                    document.querySelectorAll('#voteTargetList .player-card').forEach(card => {
                        card.classList.remove('selected');
                    });
                    playerCard.classList.add('selected');
                    votes[players[currentVoterIndex]] = name;
                });
                
                voteList.appendChild(playerCard);
            });
        }
        
        // تحديث نتيجة اللعبة
        function updateGameResult() {
            // تحديد المافيا
            let mafiaPlayer = "";
            for (const [name, role] of Object.entries(playerRoles)) {
                if (role === "المافيا") {
                    mafiaPlayer = name;
                    break;
                }
            }
            
            document.getElementById('imposterName').textContent = mafiaPlayer;
            
            // تحديث قائمة النتائج
            const resultList = document.getElementById('resultPlayersList');
            resultList.innerHTML = '';
            
            players.forEach(name => {
                const playerCard = document.createElement('div');
                playerCard.className = 'player-card';
                
                let status = "على قيد الحياة";
                let statusClass = "";
                
                // تحديد حالة اللاعب
                if (eliminatedPlayers.includes(name)) {
                    status = "ميت";
                    statusClass = "eliminated";
                }
                
                playerCard.innerHTML = `
                    <div class="player-name">${name}</div>
                    <div class="player-role">${playerRoles[name]}</div>
                    <div class="player-status" style="color: ${eliminatedPlayers.includes(name) ? '#ff6666' : '#66ff66'}; margin-top: 5px;">${status}</div>
                `;
                
                resultList.appendChild(playerCard);
            });
        }
        
        // توزيع الأدوار عشوائياً
        function assignRoles() {
            // نسخ الأدوار
            let availableRoles = [...roles];
            
            // التأكد من وجود أدوار كافية
            while (availableRoles.length < players.length) {
                availableRoles.push("المواطن");
            }
            
            // خلط الأدوار
            availableRoles = availableRoles.sort(() => Math.random() - 0.5);
            
            // توزيع الأدوار على اللاعبين
            playerRoles = {};
            players.forEach((player, index) => {
                playerRoles[player] = availableRoles[index];
            });
        }
        
        // تحديد الفائز
        function determineWinner() {
            // هذه الدالة مبسطة، في اللعبة الكاملة يجب تطبيق قواعد الفوز
            eliminatedPlayers = [];
            
            // محاكاة نتيجة الليل
            if (mafiaTarget && doctorTarget !== mafiaTarget) {
                eliminatedPlayers.push(mafiaTarget);
            }
            
            // إضافة لاعب تم التصويت عليه (مبسطة)
            const voteCounts = {};
            Object.values(votes).forEach(target => {
                voteCounts[target] = (voteCounts[target] || 0) + 1;
            });
            
            let maxVotes = 0;
            let votedOut = "";
            
            for (const [player, count] of Object.entries(voteCounts)) {
                if (count > maxVotes) {
                    maxVotes = count;
                    votedOut = player;
                }
            }
            
            if (votedOut && !eliminatedPlayers.includes(votedOut)) {
                eliminatedPlayers.push(votedOut);
            }
        }
        
        // معالجة الأحداث
        document.addEventListener('DOMContentLoaded', function() {
            // زر حفظ الاسم
            document.getElementById('saveNameBtn').addEventListener('click', function() {
                const nameInput = document.getElementById('playerName').value.trim();
                if (nameInput) {
                    playerName = nameInput;
                    players = [playerName];
                    changePage(2);
                } else {
                    alert("يرجى إدخال اسمك!");
                }
            });
            
            // زر الانضمام إلى غرفة
            document.getElementById('joinRoomBtn').addEventListener('click', function() {
                changePage(4);
            });
            
            // زر إنشاء غرفة
            document.getElementById('createRoomBtn').addEventListener('click', function() {
                roomCode = generateRoomCode();
                changePage(3);
            });
            
            // زر الرجوع من صفحة الانضمام
            document.getElementById('backToMain').addEventListener('click', function() {
                changePage(2);
            });
            
            // زر الرجوع من صفحة إنشاء الغرفة
            document.getElementById('backToMain2').addEventListener('click', function() {
                changePage(2);
            });
            
            // زر الانضمام إلى غرفة بالإدخال
            document.getElementById('confirmJoinBtn').addEventListener('click', function() {
                const codeInput = document.getElementById('joinRoomCode').value.trim();
                if (codeInput.length === 5 && /^\d+$/.test(codeInput)) {
                    roomCode = codeInput;
                    // محاكاة الانضمام إلى غرفة مع لاعبين وهميين
                    players = [playerName, "خالد", "سارة", "فهد", "نورة", "عمر"];
                    changePage(3);
                } else {
                    alert("يرجى إدخال رمز صحيح مكون من 5 أرقام!");
                }
            });
            
            // زر بدء اللعبة
            document.getElementById('startGameBtn').addEventListener('click', function() {
                // توزيع الأدوار
                assignRoles();
                currentPlayerIndex = 0;
                changePage(5);
            });
            
            // زر التالي في صفحة اختيار الدور
            document.getElementById('nextRoleBtn').addEventListener('click', function() {
                changePage(6);
            });
            
            // زر التالي في صفحة عرض الدور
            document.getElementById('nextPlayerBtn').addEventListener('click', function() {
                currentPlayerIndex++;
                
                if (currentPlayerIndex < players.length) {
                    changePage(5);
                } else {
                    changePage(7);
                }
            });
            
            // زر بدء النوم
            document.getElementById('startNightBtn').addEventListener('click', function() {
                changePage(8);
            });
            
            // زر تأكيد اختيار المافيا
            document.getElementById('confirmMafiaBtn').addEventListener('click', function() {
                if (mafiaTarget) {
                    changePage(9);
                } else {
                    alert("يرجى اختيار هدف!");
                }
            });
            
            // زر تأكيد اختيار الدكتور
            document.getElementById('confirmDoctorBtn').addEventListener('click', function() {
                if (doctorTarget) {
                    changePage(10);
                } else {
                    alert("يرجى اختيار هدف!");
                }
            });
            
            // زر تأكيد اختيار الشايب
            document.getElementById('confirmElderBtn').addEventListener('click', function() {
                if (elderTarget) {
                    // بدء التصويت
                    currentVoterIndex = 0;
                    votes = {};
                    changePage(11);
                } else {
                    alert("يرجى اختيار هدف!");
                }
            });
            
            // زر تأكيد التصويت
            document.getElementById('confirmVoteBtn').addEventListener('click', function() {
                if (votes[players[currentVoterIndex]]) {
                    currentVoterIndex++;
                    
                    if (currentVoterIndex < players.length) {
                        changePage(11);
                    } else {
                        // تحديد الفائز وعرض النتيجة
                        determineWinner();
                        changePage(12);
                    }
                } else {
                    alert("يرجى اختيار لاعب للتصويت عليه!");
                }
            });
            
            // زر لعبة جديدة
            document.getElementById('newGameBtn').addEventListener('click', function() {
                // إعادة تعيين اللعبة
                currentPlayerIndex = 0;
                currentVoterIndex = 0;
                mafiaTarget = "";
                doctorTarget = "";
                elderTarget = "";
                votes = {};
                eliminatedPlayers = [];
                
                // العودة إلى البداية
                changePage(2);
            });
            
            // السماح بإدخال الاسم بالضغط على Enter
            document.getElementById('playerName').addEventListener('keypress', function(e) {
                                if (e.key === 'Enter') {
                    document.getElementById('saveNameBtn').click();
                }
            });
            
            // السماح بإدخال رمز الغرفة بالضغط على Enter
            document.getElementById('joinRoomCode').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    document.getElementById('confirmJoinBtn').click();
                }
            });
            
            // إعداد لاعبين افتراضيين للتجربة
            window.addEventListener('load', function() {
                // وضع اسم افتراضي في حقل الاسم لتسهيل التجربة
                document.getElementById('playerName').value = "لاعب" + Math.floor(Math.random() * 100);
            });
        });
    </script>
</body>
</html>